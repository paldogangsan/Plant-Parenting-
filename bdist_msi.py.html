<html>
<head>
<title>bdist_msi.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #067d17;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
bdist_msi.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright (C) 2005, 2006 Martin von LÃ¶wis</span>
<span class="s0"># Licensed to PSF under a Contributor Agreement.</span>
<span class="s0"># The bdist_wininst command proper</span>
<span class="s0"># based on bdist_wininst</span>
<span class="s0">&quot;&quot;&quot; 
Implements the bdist_msi command. 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">import </span><span class="s1">warnings</span>
<span class="s2">from </span><span class="s1">distutils.core </span><span class="s2">import </span><span class="s1">Command</span>
<span class="s2">from </span><span class="s1">distutils.dir_util </span><span class="s2">import </span><span class="s1">remove_tree</span>
<span class="s2">from </span><span class="s1">distutils.sysconfig </span><span class="s2">import </span><span class="s1">get_python_version</span>
<span class="s2">from </span><span class="s1">distutils.version </span><span class="s2">import </span><span class="s1">StrictVersion</span>
<span class="s2">from </span><span class="s1">distutils.errors </span><span class="s2">import </span><span class="s1">DistutilsOptionError</span>
<span class="s2">from </span><span class="s1">distutils.util </span><span class="s2">import </span><span class="s1">get_platform</span>
<span class="s2">from </span><span class="s1">distutils </span><span class="s2">import </span><span class="s1">log</span>
<span class="s2">import </span><span class="s1">msilib</span>
<span class="s2">from </span><span class="s1">msilib </span><span class="s2">import </span><span class="s1">schema, sequence, text</span>
<span class="s2">from </span><span class="s1">msilib </span><span class="s2">import </span><span class="s1">Directory, Feature, Dialog, add_data</span>

<span class="s2">class </span><span class="s1">PyDialog(Dialog):</span>
    <span class="s0">&quot;&quot;&quot;Dialog class with a fixed layout: controls at the top, then a ruler, 
    then a list of buttons: back, next, cancel. Optionally a bitmap at the 
    left.&quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">__init__(self, *args, **kw):</span>
        <span class="s0">&quot;&quot;&quot;Dialog(database, name, x, y, w, h, attributes, title, first, 
        default, cancel, bitmap=true)&quot;&quot;&quot;</span>
        <span class="s1">Dialog.__init__(self, *args)</span>
        <span class="s1">ruler = self.h - </span><span class="s3">36</span>
        <span class="s1">bmwidth = </span><span class="s3">152</span><span class="s1">*ruler/</span><span class="s3">328</span>
        <span class="s0">#if kw.get(&quot;bitmap&quot;, True):</span>
        <span class="s0">#    self.bitmap(&quot;Bitmap&quot;, 0, 0, bmwidth, ruler, &quot;PythonWin&quot;)</span>
        <span class="s1">self.line(</span><span class="s4">&quot;BottomLine&quot;</span><span class="s1">, </span><span class="s3">0</span><span class="s1">, ruler, self.w, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">title(self, title):</span>
        <span class="s0">&quot;Set the title text of the dialog at the top.&quot;</span>
        <span class="s0"># name, x, y, w, h, flags=Visible|Enabled|Transparent|NoPrefix,</span>
        <span class="s0"># text, in VerdanaBold10</span>
        <span class="s1">self.text(</span><span class="s4">&quot;Title&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">10</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">60</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                  <span class="s4">r&quot;{\VerdanaBold10}%s&quot; </span><span class="s1">% title)</span>

    <span class="s2">def </span><span class="s1">back(self, title, next, name = </span><span class="s4">&quot;Back&quot;</span><span class="s1">, active = </span><span class="s3">1</span><span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Add a back button with a given title, the tab-next button, 
        its name in the Control table, possibly initially disabled. 
 
        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">active:</span>
            <span class="s1">flags = </span><span class="s3">3 </span><span class="s0"># Visible|Enabled</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">flags = </span><span class="s3">1 </span><span class="s0"># Visible</span>
        <span class="s2">return </span><span class="s1">self.pushbutton(name, </span><span class="s3">180</span><span class="s1">, self.h-</span><span class="s3">27 </span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, flags, title, next)</span>

    <span class="s2">def </span><span class="s1">cancel(self, title, next, name = </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, active = </span><span class="s3">1</span><span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Add a cancel button with a given title, the tab-next button, 
        its name in the Control table, possibly initially disabled. 
 
        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">active:</span>
            <span class="s1">flags = </span><span class="s3">3 </span><span class="s0"># Visible|Enabled</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">flags = </span><span class="s3">1 </span><span class="s0"># Visible</span>
        <span class="s2">return </span><span class="s1">self.pushbutton(name, </span><span class="s3">304</span><span class="s1">, self.h-</span><span class="s3">27</span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, flags, title, next)</span>

    <span class="s2">def </span><span class="s1">next(self, title, next, name = </span><span class="s4">&quot;Next&quot;</span><span class="s1">, active = </span><span class="s3">1</span><span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Add a Next button with a given title, the tab-next button, 
        its name in the Control table, possibly initially disabled. 
 
        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">active:</span>
            <span class="s1">flags = </span><span class="s3">3 </span><span class="s0"># Visible|Enabled</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">flags = </span><span class="s3">1 </span><span class="s0"># Visible</span>
        <span class="s2">return </span><span class="s1">self.pushbutton(name, </span><span class="s3">236</span><span class="s1">, self.h-</span><span class="s3">27</span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, flags, title, next)</span>

    <span class="s2">def </span><span class="s1">xbutton(self, name, title, next, xpos):</span>
        <span class="s0">&quot;&quot;&quot;Add a button with a given title, the tab-next button, 
        its name in the Control table, giving its x position; the 
        y-position is aligned with the other buttons. 
 
        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self.pushbutton(name, int(self.w*xpos - </span><span class="s3">28</span><span class="s1">), self.h-</span><span class="s3">27</span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, title, next)</span>

<span class="s2">class </span><span class="s1">bdist_msi(Command):</span>

    <span class="s1">description = </span><span class="s4">&quot;create a Microsoft Installer (.msi) binary distribution&quot;</span>

    <span class="s1">user_options = [(</span><span class="s4">'bdist-dir='</span><span class="s1">, </span><span class="s2">None</span><span class="s1">,</span>
                     <span class="s4">&quot;temporary directory for creating the distribution&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'plat-name='</span><span class="s1">, </span><span class="s4">'p'</span><span class="s1">,</span>
                     <span class="s4">&quot;platform name to embed in generated filenames &quot;</span>
                     <span class="s4">&quot;(default: %s)&quot; </span><span class="s1">% get_platform()),</span>
                    <span class="s1">(</span><span class="s4">'keep-temp'</span><span class="s1">, </span><span class="s4">'k'</span><span class="s1">,</span>
                     <span class="s4">&quot;keep the pseudo-installation tree around after &quot; </span><span class="s1">+</span>
                     <span class="s4">&quot;creating the distribution archive&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'target-version='</span><span class="s1">, </span><span class="s2">None</span><span class="s1">,</span>
                     <span class="s4">&quot;require a specific python version&quot; </span><span class="s1">+</span>
                     <span class="s4">&quot; on the target system&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'no-target-compile'</span><span class="s1">, </span><span class="s4">'c'</span><span class="s1">,</span>
                     <span class="s4">&quot;do not compile .py to .pyc on the target system&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'no-target-optimize'</span><span class="s1">, </span><span class="s4">'o'</span><span class="s1">,</span>
                     <span class="s4">&quot;do not compile .py to .pyo (optimized) &quot;</span>
                     <span class="s4">&quot;on the target system&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'dist-dir='</span><span class="s1">, </span><span class="s4">'d'</span><span class="s1">,</span>
                     <span class="s4">&quot;directory to put final built distributions in&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'skip-build'</span><span class="s1">, </span><span class="s2">None</span><span class="s1">,</span>
                     <span class="s4">&quot;skip rebuilding everything (for testing/debugging)&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'install-script='</span><span class="s1">, </span><span class="s2">None</span><span class="s1">,</span>
                     <span class="s4">&quot;basename of installation script to be run after &quot;</span>
                     <span class="s4">&quot;installation or before deinstallation&quot;</span><span class="s1">),</span>
                    <span class="s1">(</span><span class="s4">'pre-install-script='</span><span class="s1">, </span><span class="s2">None</span><span class="s1">,</span>
                     <span class="s4">&quot;Fully qualified filename of a script to be run before &quot;</span>
                     <span class="s4">&quot;any files are installed.  This script need not be in the &quot;</span>
                     <span class="s4">&quot;distribution&quot;</span><span class="s1">),</span>
                   <span class="s1">]</span>

    <span class="s1">boolean_options = [</span><span class="s4">'keep-temp'</span><span class="s1">, </span><span class="s4">'no-target-compile'</span><span class="s1">, </span><span class="s4">'no-target-optimize'</span><span class="s1">,</span>
                       <span class="s4">'skip-build'</span><span class="s1">]</span>

    <span class="s1">all_versions = [</span><span class="s4">'2.0'</span><span class="s1">, </span><span class="s4">'2.1'</span><span class="s1">, </span><span class="s4">'2.2'</span><span class="s1">, </span><span class="s4">'2.3'</span><span class="s1">, </span><span class="s4">'2.4'</span><span class="s1">,</span>
                    <span class="s4">'2.5'</span><span class="s1">, </span><span class="s4">'2.6'</span><span class="s1">, </span><span class="s4">'2.7'</span><span class="s1">, </span><span class="s4">'2.8'</span><span class="s1">, </span><span class="s4">'2.9'</span><span class="s1">,</span>
                    <span class="s4">'3.0'</span><span class="s1">, </span><span class="s4">'3.1'</span><span class="s1">, </span><span class="s4">'3.2'</span><span class="s1">, </span><span class="s4">'3.3'</span><span class="s1">, </span><span class="s4">'3.4'</span><span class="s1">,</span>
                    <span class="s4">'3.5'</span><span class="s1">, </span><span class="s4">'3.6'</span><span class="s1">, </span><span class="s4">'3.7'</span><span class="s1">, </span><span class="s4">'3.8'</span><span class="s1">, </span><span class="s4">'3.9'</span><span class="s1">]</span>
    <span class="s1">other_version = </span><span class="s4">'X'</span>

    <span class="s2">def </span><span class="s1">__init__(self, *args, **kw):</span>
        <span class="s1">super().__init__(*args, **kw)</span>
        <span class="s1">warnings.warn(</span><span class="s4">&quot;bdist_msi command is deprecated since Python 3.9, &quot;</span>
                      <span class="s4">&quot;use bdist_wheel (wheel packages) instead&quot;</span><span class="s1">,</span>
                      <span class="s1">DeprecationWarning, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">initialize_options(self):</span>
        <span class="s1">self.bdist_dir = </span><span class="s2">None</span>
        <span class="s1">self.plat_name = </span><span class="s2">None</span>
        <span class="s1">self.keep_temp = </span><span class="s3">0</span>
        <span class="s1">self.no_target_compile = </span><span class="s3">0</span>
        <span class="s1">self.no_target_optimize = </span><span class="s3">0</span>
        <span class="s1">self.target_version = </span><span class="s2">None</span>
        <span class="s1">self.dist_dir = </span><span class="s2">None</span>
        <span class="s1">self.skip_build = </span><span class="s2">None</span>
        <span class="s1">self.install_script = </span><span class="s2">None</span>
        <span class="s1">self.pre_install_script = </span><span class="s2">None</span>
        <span class="s1">self.versions = </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">finalize_options(self):</span>
        <span class="s1">self.set_undefined_options(</span><span class="s4">'bdist'</span><span class="s1">, (</span><span class="s4">'skip_build'</span><span class="s1">, </span><span class="s4">'skip_build'</span><span class="s1">))</span>

        <span class="s2">if </span><span class="s1">self.bdist_dir </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">bdist_base = self.get_finalized_command(</span><span class="s4">'bdist'</span><span class="s1">).bdist_base</span>
            <span class="s1">self.bdist_dir = os.path.join(bdist_base, </span><span class="s4">'msi'</span><span class="s1">)</span>

        <span class="s1">short_version = get_python_version()</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s2">not </span><span class="s1">self.target_version) </span><span class="s2">and </span><span class="s1">self.distribution.has_ext_modules():</span>
            <span class="s1">self.target_version = short_version</span>

        <span class="s2">if </span><span class="s1">self.target_version:</span>
            <span class="s1">self.versions = [self.target_version]</span>
            <span class="s2">if not </span><span class="s1">self.skip_build </span><span class="s2">and </span><span class="s1">self.distribution.has_ext_modules()\</span>
               <span class="s2">and </span><span class="s1">self.target_version != short_version:</span>
                <span class="s2">raise </span><span class="s1">DistutilsOptionError(</span>
                      <span class="s4">&quot;target version can only be %s, or the '--skip-build'&quot;</span>
                      <span class="s4">&quot; option must be specified&quot; </span><span class="s1">% (short_version,))</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.versions = list(self.all_versions)</span>

        <span class="s1">self.set_undefined_options(</span><span class="s4">'bdist'</span><span class="s1">,</span>
                                   <span class="s1">(</span><span class="s4">'dist_dir'</span><span class="s1">, </span><span class="s4">'dist_dir'</span><span class="s1">),</span>
                                   <span class="s1">(</span><span class="s4">'plat_name'</span><span class="s1">, </span><span class="s4">'plat_name'</span><span class="s1">),</span>
                                   <span class="s1">)</span>

        <span class="s2">if </span><span class="s1">self.pre_install_script:</span>
            <span class="s2">raise </span><span class="s1">DistutilsOptionError(</span>
                  <span class="s4">&quot;the pre-install-script feature is not yet implemented&quot;</span><span class="s1">)</span>

        <span class="s2">if </span><span class="s1">self.install_script:</span>
            <span class="s2">for </span><span class="s1">script </span><span class="s2">in </span><span class="s1">self.distribution.scripts:</span>
                <span class="s2">if </span><span class="s1">self.install_script == os.path.basename(script):</span>
                    <span class="s2">break</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">DistutilsOptionError(</span>
                      <span class="s4">&quot;install_script '%s' not found in scripts&quot;</span>
                      <span class="s1">% self.install_script)</span>
        <span class="s1">self.install_script_key = </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">run(self):</span>
        <span class="s2">if not </span><span class="s1">self.skip_build:</span>
            <span class="s1">self.run_command(</span><span class="s4">'build'</span><span class="s1">)</span>

        <span class="s1">install = self.reinitialize_command(</span><span class="s4">'install'</span><span class="s1">, reinit_subcommands=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">install.prefix = self.bdist_dir</span>
        <span class="s1">install.skip_build = self.skip_build</span>
        <span class="s1">install.warn_dir = </span><span class="s3">0</span>

        <span class="s1">install_lib = self.reinitialize_command(</span><span class="s4">'install_lib'</span><span class="s1">)</span>
        <span class="s0"># we do not want to include pyc or pyo files</span>
        <span class="s1">install_lib.compile = </span><span class="s3">0</span>
        <span class="s1">install_lib.optimize = </span><span class="s3">0</span>

        <span class="s2">if </span><span class="s1">self.distribution.has_ext_modules():</span>
            <span class="s0"># If we are building an installer for a Python version other</span>
            <span class="s0"># than the one we are currently running, then we need to ensure</span>
            <span class="s0"># our build_lib reflects the other Python version rather than ours.</span>
            <span class="s0"># Note that for target_version!=sys.version, we must have skipped the</span>
            <span class="s0"># build step, so there is no issue with enforcing the build of this</span>
            <span class="s0"># version.</span>
            <span class="s1">target_version = self.target_version</span>
            <span class="s2">if not </span><span class="s1">target_version:</span>
                <span class="s2">assert </span><span class="s1">self.skip_build, </span><span class="s4">&quot;Should have already checked this&quot;</span>
                <span class="s1">target_version = </span><span class="s4">'%d.%d' </span><span class="s1">% sys.version_info[:</span><span class="s3">2</span><span class="s1">]</span>
            <span class="s1">plat_specifier = </span><span class="s4">&quot;.%s-%s&quot; </span><span class="s1">% (self.plat_name, target_version)</span>
            <span class="s1">build = self.get_finalized_command(</span><span class="s4">'build'</span><span class="s1">)</span>
            <span class="s1">build.build_lib = os.path.join(build.build_base,</span>
                                           <span class="s4">'lib' </span><span class="s1">+ plat_specifier)</span>

        <span class="s1">log.info(</span><span class="s4">&quot;installing to %s&quot;</span><span class="s1">, self.bdist_dir)</span>
        <span class="s1">install.ensure_finalized()</span>

        <span class="s0"># avoid warning of 'install_lib' about installing</span>
        <span class="s0"># into a directory not in sys.path</span>
        <span class="s1">sys.path.insert(</span><span class="s3">0</span><span class="s1">, os.path.join(self.bdist_dir, </span><span class="s4">'PURELIB'</span><span class="s1">))</span>

        <span class="s1">install.run()</span>

        <span class="s2">del </span><span class="s1">sys.path[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">self.mkpath(self.dist_dir)</span>
        <span class="s1">fullname = self.distribution.get_fullname()</span>
        <span class="s1">installer_name = self.get_installer_filename(fullname)</span>
        <span class="s1">installer_name = os.path.abspath(installer_name)</span>
        <span class="s2">if </span><span class="s1">os.path.exists(installer_name): os.unlink(installer_name)</span>

        <span class="s1">metadata = self.distribution.metadata</span>
        <span class="s1">author = metadata.author</span>
        <span class="s2">if not </span><span class="s1">author:</span>
            <span class="s1">author = metadata.maintainer</span>
        <span class="s2">if not </span><span class="s1">author:</span>
            <span class="s1">author = </span><span class="s4">&quot;UNKNOWN&quot;</span>
        <span class="s1">version = metadata.get_version()</span>
        <span class="s0"># ProductVersion must be strictly numeric</span>
        <span class="s0"># XXX need to deal with prerelease versions</span>
        <span class="s1">sversion = </span><span class="s4">&quot;%d.%d.%d&quot; </span><span class="s1">% StrictVersion(version).version</span>
        <span class="s0"># Prefix ProductName with Python x.y, so that</span>
        <span class="s0"># it sorts together with the other Python packages</span>
        <span class="s0"># in Add-Remove-Programs (APR)</span>
        <span class="s1">fullname = self.distribution.get_fullname()</span>
        <span class="s2">if </span><span class="s1">self.target_version:</span>
            <span class="s1">product_name = </span><span class="s4">&quot;Python %s %s&quot; </span><span class="s1">% (self.target_version, fullname)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">product_name = </span><span class="s4">&quot;Python %s&quot; </span><span class="s1">% (fullname)</span>
        <span class="s1">self.db = msilib.init_database(installer_name, schema,</span>
                <span class="s1">product_name, msilib.gen_uuid(),</span>
                <span class="s1">sversion, author)</span>
        <span class="s1">msilib.add_tables(self.db, sequence)</span>
        <span class="s1">props = [(</span><span class="s4">'DistVersion'</span><span class="s1">, version)]</span>
        <span class="s1">email = metadata.author_email </span><span class="s2">or </span><span class="s1">metadata.maintainer_email</span>
        <span class="s2">if </span><span class="s1">email:</span>
            <span class="s1">props.append((</span><span class="s4">&quot;ARPCONTACT&quot;</span><span class="s1">, email))</span>
        <span class="s2">if </span><span class="s1">metadata.url:</span>
            <span class="s1">props.append((</span><span class="s4">&quot;ARPURLINFOABOUT&quot;</span><span class="s1">, metadata.url))</span>
        <span class="s2">if </span><span class="s1">props:</span>
            <span class="s1">add_data(self.db, </span><span class="s4">'Property'</span><span class="s1">, props)</span>

        <span class="s1">self.add_find_python()</span>
        <span class="s1">self.add_files()</span>
        <span class="s1">self.add_scripts()</span>
        <span class="s1">self.add_ui()</span>
        <span class="s1">self.db.Commit()</span>

        <span class="s2">if </span><span class="s1">hasattr(self.distribution, </span><span class="s4">'dist_files'</span><span class="s1">):</span>
            <span class="s1">tup = </span><span class="s4">'bdist_msi'</span><span class="s1">, self.target_version </span><span class="s2">or </span><span class="s4">'any'</span><span class="s1">, fullname</span>
            <span class="s1">self.distribution.dist_files.append(tup)</span>

        <span class="s2">if not </span><span class="s1">self.keep_temp:</span>
            <span class="s1">remove_tree(self.bdist_dir, dry_run=self.dry_run)</span>

    <span class="s2">def </span><span class="s1">add_files(self):</span>
        <span class="s1">db = self.db</span>
        <span class="s1">cab = msilib.CAB(</span><span class="s4">&quot;distfiles&quot;</span><span class="s1">)</span>
        <span class="s1">rootdir = os.path.abspath(self.bdist_dir)</span>

        <span class="s1">root = Directory(db, cab, </span><span class="s2">None</span><span class="s1">, rootdir, </span><span class="s4">&quot;TARGETDIR&quot;</span><span class="s1">, </span><span class="s4">&quot;SourceDir&quot;</span><span class="s1">)</span>
        <span class="s1">f = Feature(db, </span><span class="s4">&quot;Python&quot;</span><span class="s1">, </span><span class="s4">&quot;Python&quot;</span><span class="s1">, </span><span class="s4">&quot;Everything&quot;</span><span class="s1">,</span>
                    <span class="s3">0</span><span class="s1">, </span><span class="s3">1</span><span class="s1">, directory=</span><span class="s4">&quot;TARGETDIR&quot;</span><span class="s1">)</span>

        <span class="s1">items = [(f, root, </span><span class="s4">''</span><span class="s1">)]</span>
        <span class="s2">for </span><span class="s1">version </span><span class="s2">in </span><span class="s1">self.versions + [self.other_version]:</span>
            <span class="s1">target = </span><span class="s4">&quot;TARGETDIR&quot; </span><span class="s1">+ version</span>
            <span class="s1">name = default = </span><span class="s4">&quot;Python&quot; </span><span class="s1">+ version</span>
            <span class="s1">desc = </span><span class="s4">&quot;Everything&quot;</span>
            <span class="s2">if </span><span class="s1">version </span><span class="s2">is </span><span class="s1">self.other_version:</span>
                <span class="s1">title = </span><span class="s4">&quot;Python from another location&quot;</span>
                <span class="s1">level = </span><span class="s3">2</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">title = </span><span class="s4">&quot;Python %s from registry&quot; </span><span class="s1">% version</span>
                <span class="s1">level = </span><span class="s3">1</span>
            <span class="s1">f = Feature(db, name, title, desc, </span><span class="s3">1</span><span class="s1">, level, directory=target)</span>
            <span class="s1">dir = Directory(db, cab, root, rootdir, target, default)</span>
            <span class="s1">items.append((f, dir, version))</span>
        <span class="s1">db.Commit()</span>

        <span class="s1">seen = {}</span>
        <span class="s2">for </span><span class="s1">feature, dir, version </span><span class="s2">in </span><span class="s1">items:</span>
            <span class="s1">todo = [dir]</span>
            <span class="s2">while </span><span class="s1">todo:</span>
                <span class="s1">dir = todo.pop()</span>
                <span class="s2">for </span><span class="s1">file </span><span class="s2">in </span><span class="s1">os.listdir(dir.absolute):</span>
                    <span class="s1">afile = os.path.join(dir.absolute, file)</span>
                    <span class="s2">if </span><span class="s1">os.path.isdir(afile):</span>
                        <span class="s1">short = </span><span class="s4">&quot;%s|%s&quot; </span><span class="s1">% (dir.make_short(file), file)</span>
                        <span class="s1">default = file + version</span>
                        <span class="s1">newdir = Directory(db, cab, dir, file, default, short)</span>
                        <span class="s1">todo.append(newdir)</span>
                    <span class="s2">else</span><span class="s1">:</span>
                        <span class="s2">if not </span><span class="s1">dir.component:</span>
                            <span class="s1">dir.start_component(dir.logical, feature, </span><span class="s3">0</span><span class="s1">)</span>
                        <span class="s2">if </span><span class="s1">afile </span><span class="s2">not in </span><span class="s1">seen:</span>
                            <span class="s1">key = seen[afile] = dir.add_file(file)</span>
                            <span class="s2">if </span><span class="s1">file==self.install_script:</span>
                                <span class="s2">if </span><span class="s1">self.install_script_key:</span>
                                    <span class="s2">raise </span><span class="s1">DistutilsOptionError(</span>
                                          <span class="s4">&quot;Multiple files with name %s&quot; </span><span class="s1">% file)</span>
                                <span class="s1">self.install_script_key = </span><span class="s4">'[#%s]' </span><span class="s1">% key</span>
                        <span class="s2">else</span><span class="s1">:</span>
                            <span class="s1">key = seen[afile]</span>
                            <span class="s1">add_data(self.db, </span><span class="s4">&quot;DuplicateFile&quot;</span><span class="s1">,</span>
                                <span class="s1">[(key + version, dir.component, key, </span><span class="s2">None</span><span class="s1">, dir.logical)])</span>
            <span class="s1">db.Commit()</span>
        <span class="s1">cab.commit(db)</span>

    <span class="s2">def </span><span class="s1">add_find_python(self):</span>
        <span class="s0">&quot;&quot;&quot;Adds code to the installer to compute the location of Python. 
 
        Properties PYTHON.MACHINE.X.Y and PYTHON.USER.X.Y will be set from the 
        registry for each version of Python. 
 
        Properties TARGETDIRX.Y will be set from PYTHON.USER.X.Y if defined, 
        else from PYTHON.MACHINE.X.Y. 
 
        Properties PYTHONX.Y will be set to TARGETDIRX.Y\\python.exe&quot;&quot;&quot;</span>

        <span class="s1">start = </span><span class="s3">402</span>
        <span class="s2">for </span><span class="s1">ver </span><span class="s2">in </span><span class="s1">self.versions:</span>
            <span class="s1">install_path = </span><span class="s4">r&quot;SOFTWARE\Python\PythonCore\%s\InstallPath&quot; </span><span class="s1">% ver</span>
            <span class="s1">machine_reg = </span><span class="s4">&quot;python.machine.&quot; </span><span class="s1">+ ver</span>
            <span class="s1">user_reg = </span><span class="s4">&quot;python.user.&quot; </span><span class="s1">+ ver</span>
            <span class="s1">machine_prop = </span><span class="s4">&quot;PYTHON.MACHINE.&quot; </span><span class="s1">+ ver</span>
            <span class="s1">user_prop = </span><span class="s4">&quot;PYTHON.USER.&quot; </span><span class="s1">+ ver</span>
            <span class="s1">machine_action = </span><span class="s4">&quot;PythonFromMachine&quot; </span><span class="s1">+ ver</span>
            <span class="s1">user_action = </span><span class="s4">&quot;PythonFromUser&quot; </span><span class="s1">+ ver</span>
            <span class="s1">exe_action = </span><span class="s4">&quot;PythonExe&quot; </span><span class="s1">+ ver</span>
            <span class="s1">target_dir_prop = </span><span class="s4">&quot;TARGETDIR&quot; </span><span class="s1">+ ver</span>
            <span class="s1">exe_prop = </span><span class="s4">&quot;PYTHON&quot; </span><span class="s1">+ ver</span>
            <span class="s2">if </span><span class="s1">msilib.Win64:</span>
                <span class="s0"># type: msidbLocatorTypeRawValue + msidbLocatorType64bit</span>
                <span class="s1">Type = </span><span class="s3">2</span><span class="s1">+</span><span class="s3">16</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">Type = </span><span class="s3">2</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;RegLocator&quot;</span><span class="s1">,</span>
                    <span class="s1">[(machine_reg, </span><span class="s3">2</span><span class="s1">, install_path, </span><span class="s2">None</span><span class="s1">, Type),</span>
                     <span class="s1">(user_reg, </span><span class="s3">1</span><span class="s1">, install_path, </span><span class="s2">None</span><span class="s1">, Type)])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;AppSearch&quot;</span><span class="s1">,</span>
                    <span class="s1">[(machine_prop, machine_reg),</span>
                     <span class="s1">(user_prop, user_reg)])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;CustomAction&quot;</span><span class="s1">,</span>
                    <span class="s1">[(machine_action, </span><span class="s3">51</span><span class="s1">+</span><span class="s3">256</span><span class="s1">, target_dir_prop, </span><span class="s4">&quot;[&quot; </span><span class="s1">+ machine_prop + </span><span class="s4">&quot;]&quot;</span><span class="s1">),</span>
                     <span class="s1">(user_action, </span><span class="s3">51</span><span class="s1">+</span><span class="s3">256</span><span class="s1">, target_dir_prop, </span><span class="s4">&quot;[&quot; </span><span class="s1">+ user_prop + </span><span class="s4">&quot;]&quot;</span><span class="s1">),</span>
                     <span class="s1">(exe_action, </span><span class="s3">51</span><span class="s1">+</span><span class="s3">256</span><span class="s1">, exe_prop, </span><span class="s4">&quot;[&quot; </span><span class="s1">+ target_dir_prop + </span><span class="s4">&quot;]</span><span class="s5">\\</span><span class="s4">python.exe&quot;</span><span class="s1">),</span>
                    <span class="s1">])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;InstallExecuteSequence&quot;</span><span class="s1">,</span>
                    <span class="s1">[(machine_action, machine_prop, start),</span>
                     <span class="s1">(user_action, user_prop, start + </span><span class="s3">1</span><span class="s1">),</span>
                     <span class="s1">(exe_action, </span><span class="s2">None</span><span class="s1">, start + </span><span class="s3">2</span><span class="s1">),</span>
                    <span class="s1">])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;InstallUISequence&quot;</span><span class="s1">,</span>
                    <span class="s1">[(machine_action, machine_prop, start),</span>
                     <span class="s1">(user_action, user_prop, start + </span><span class="s3">1</span><span class="s1">),</span>
                     <span class="s1">(exe_action, </span><span class="s2">None</span><span class="s1">, start + </span><span class="s3">2</span><span class="s1">),</span>
                    <span class="s1">])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;Condition&quot;</span><span class="s1">,</span>
                    <span class="s1">[(</span><span class="s4">&quot;Python&quot; </span><span class="s1">+ ver, </span><span class="s3">0</span><span class="s1">, </span><span class="s4">&quot;NOT TARGETDIR&quot; </span><span class="s1">+ ver)])</span>
            <span class="s1">start += </span><span class="s3">4</span>
            <span class="s2">assert </span><span class="s1">start &lt; </span><span class="s3">500</span>

    <span class="s2">def </span><span class="s1">add_scripts(self):</span>
        <span class="s2">if </span><span class="s1">self.install_script:</span>
            <span class="s1">start = </span><span class="s3">6800</span>
            <span class="s2">for </span><span class="s1">ver </span><span class="s2">in </span><span class="s1">self.versions + [self.other_version]:</span>
                <span class="s1">install_action = </span><span class="s4">&quot;install_script.&quot; </span><span class="s1">+ ver</span>
                <span class="s1">exe_prop = </span><span class="s4">&quot;PYTHON&quot; </span><span class="s1">+ ver</span>
                <span class="s1">add_data(self.db, </span><span class="s4">&quot;CustomAction&quot;</span><span class="s1">,</span>
                        <span class="s1">[(install_action, </span><span class="s3">50</span><span class="s1">, exe_prop, self.install_script_key)])</span>
                <span class="s1">add_data(self.db, </span><span class="s4">&quot;InstallExecuteSequence&quot;</span><span class="s1">,</span>
                        <span class="s1">[(install_action, </span><span class="s4">&quot;&amp;Python%s=3&quot; </span><span class="s1">% ver, start)])</span>
                <span class="s1">start += </span><span class="s3">1</span>
        <span class="s0"># XXX pre-install scripts are currently refused in finalize_options()</span>
        <span class="s0">#     but if this feature is completed, it will also need to add</span>
        <span class="s0">#     entries for each version as the above code does</span>
        <span class="s2">if </span><span class="s1">self.pre_install_script:</span>
            <span class="s1">scriptfn = os.path.join(self.bdist_dir, </span><span class="s4">&quot;preinstall.bat&quot;</span><span class="s1">)</span>
            <span class="s2">with </span><span class="s1">open(scriptfn, </span><span class="s4">&quot;w&quot;</span><span class="s1">) </span><span class="s2">as </span><span class="s1">f:</span>
                <span class="s0"># The batch file will be executed with [PYTHON], so that %1</span>
                <span class="s0"># is the path to the Python interpreter; %0 will be the path</span>
                <span class="s0"># of the batch file.</span>
                <span class="s0"># rem =&quot;&quot;&quot;</span>
                <span class="s0"># %1 %0</span>
                <span class="s0"># exit</span>
                <span class="s0"># &quot;&quot;&quot;</span>
                <span class="s0"># &lt;actual script&gt;</span>
                <span class="s1">f.write(</span><span class="s4">'rem =&quot;&quot;&quot;</span><span class="s5">\n</span><span class="s4">%1 %0</span><span class="s5">\n</span><span class="s4">exit</span><span class="s5">\n</span><span class="s4">&quot;&quot;&quot;</span><span class="s5">\n</span><span class="s4">'</span><span class="s1">)</span>
                <span class="s2">with </span><span class="s1">open(self.pre_install_script) </span><span class="s2">as </span><span class="s1">fin:</span>
                    <span class="s1">f.write(fin.read())</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;Binary&quot;</span><span class="s1">,</span>
                <span class="s1">[(</span><span class="s4">&quot;PreInstall&quot;</span><span class="s1">, msilib.Binary(scriptfn))</span>
                <span class="s1">])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;CustomAction&quot;</span><span class="s1">,</span>
                <span class="s1">[(</span><span class="s4">&quot;PreInstall&quot;</span><span class="s1">, </span><span class="s3">2</span><span class="s1">, </span><span class="s4">&quot;PreInstall&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
                <span class="s1">])</span>
            <span class="s1">add_data(self.db, </span><span class="s4">&quot;InstallExecuteSequence&quot;</span><span class="s1">,</span>
                    <span class="s1">[(</span><span class="s4">&quot;PreInstall&quot;</span><span class="s1">, </span><span class="s4">&quot;NOT Installed&quot;</span><span class="s1">, </span><span class="s3">450</span><span class="s1">)])</span>


    <span class="s2">def </span><span class="s1">add_ui(self):</span>
        <span class="s1">db = self.db</span>
        <span class="s1">x = y = </span><span class="s3">50</span>
        <span class="s1">w = </span><span class="s3">370</span>
        <span class="s1">h = </span><span class="s3">300</span>
        <span class="s1">title = </span><span class="s4">&quot;[ProductName] Setup&quot;</span>

        <span class="s0"># see &quot;Dialog Style Bits&quot;</span>
        <span class="s1">modal = </span><span class="s3">3      </span><span class="s0"># visible | modal</span>
        <span class="s1">modeless = </span><span class="s3">1   </span><span class="s0"># visible</span>
        <span class="s1">track_disk_space = </span><span class="s3">32</span>

        <span class="s0"># UI customization properties</span>
        <span class="s1">add_data(db, </span><span class="s4">&quot;Property&quot;</span><span class="s1">,</span>
                 <span class="s0"># See &quot;DefaultUIFont Property&quot;</span>
                 <span class="s1">[(</span><span class="s4">&quot;DefaultUIFont&quot;</span><span class="s1">, </span><span class="s4">&quot;DlgFont8&quot;</span><span class="s1">),</span>
                  <span class="s0"># See &quot;ErrorDialog Style Bit&quot;</span>
                  <span class="s1">(</span><span class="s4">&quot;ErrorDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;ErrorDlg&quot;</span><span class="s1">),</span>
                  <span class="s1">(</span><span class="s4">&quot;Progress1&quot;</span><span class="s1">, </span><span class="s4">&quot;Install&quot;</span><span class="s1">),   </span><span class="s0"># modified in maintenance type dlg</span>
                  <span class="s1">(</span><span class="s4">&quot;Progress2&quot;</span><span class="s1">, </span><span class="s4">&quot;installs&quot;</span><span class="s1">),</span>
                  <span class="s1">(</span><span class="s4">&quot;MaintenanceForm_Action&quot;</span><span class="s1">, </span><span class="s4">&quot;Repair&quot;</span><span class="s1">),</span>
                  <span class="s0"># possible values: ALL, JUSTME</span>
                  <span class="s1">(</span><span class="s4">&quot;WhichUsers&quot;</span><span class="s1">, </span><span class="s4">&quot;ALL&quot;</span><span class="s1">)</span>
                 <span class="s1">])</span>

        <span class="s0"># Fonts, see &quot;TextStyle Table&quot;</span>
        <span class="s1">add_data(db, </span><span class="s4">&quot;TextStyle&quot;</span><span class="s1">,</span>
                 <span class="s1">[(</span><span class="s4">&quot;DlgFont8&quot;</span><span class="s1">, </span><span class="s4">&quot;Tahoma&quot;</span><span class="s1">, </span><span class="s3">9</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s3">0</span><span class="s1">),</span>
                  <span class="s1">(</span><span class="s4">&quot;DlgFontBold8&quot;</span><span class="s1">, </span><span class="s4">&quot;Tahoma&quot;</span><span class="s1">, </span><span class="s3">8</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s3">1</span><span class="s1">), </span><span class="s0">#bold</span>
                  <span class="s1">(</span><span class="s4">&quot;VerdanaBold10&quot;</span><span class="s1">, </span><span class="s4">&quot;Verdana&quot;</span><span class="s1">, </span><span class="s3">10</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s3">1</span><span class="s1">),</span>
                  <span class="s1">(</span><span class="s4">&quot;VerdanaRed9&quot;</span><span class="s1">, </span><span class="s4">&quot;Verdana&quot;</span><span class="s1">, </span><span class="s3">9</span><span class="s1">, </span><span class="s3">255</span><span class="s1">, </span><span class="s3">0</span><span class="s1">),</span>
                 <span class="s1">])</span>

        <span class="s0"># UI Sequences, see &quot;InstallUISequence Table&quot;, &quot;Using a Sequence Table&quot;</span>
        <span class="s0"># Numbers indicate sequence; see sequence.py for how these action integrate</span>
        <span class="s1">add_data(db, </span><span class="s4">&quot;InstallUISequence&quot;</span><span class="s1">,</span>
                 <span class="s1">[(</span><span class="s4">&quot;PrepareDlg&quot;</span><span class="s1">, </span><span class="s4">&quot;Not Privileged or Windows9x or Installed&quot;</span><span class="s1">, </span><span class="s3">140</span><span class="s1">),</span>
                  <span class="s1">(</span><span class="s4">&quot;WhichUsersDlg&quot;</span><span class="s1">, </span><span class="s4">&quot;Privileged and not Windows9x and not Installed&quot;</span><span class="s1">, </span><span class="s3">141</span><span class="s1">),</span>
                  <span class="s0"># In the user interface, assume all-users installation if privileged.</span>
                  <span class="s1">(</span><span class="s4">&quot;SelectFeaturesDlg&quot;</span><span class="s1">, </span><span class="s4">&quot;Not Installed&quot;</span><span class="s1">, </span><span class="s3">1230</span><span class="s1">),</span>
                  <span class="s0"># XXX no support for resume installations yet</span>
                  <span class="s0">#(&quot;ResumeDlg&quot;, &quot;Installed AND (RESUME OR Preselected)&quot;, 1240),</span>
                  <span class="s1">(</span><span class="s4">&quot;MaintenanceTypeDlg&quot;</span><span class="s1">, </span><span class="s4">&quot;Installed AND NOT RESUME AND NOT Preselected&quot;</span><span class="s1">, </span><span class="s3">1250</span><span class="s1">),</span>
                  <span class="s1">(</span><span class="s4">&quot;ProgressDlg&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s3">1280</span><span class="s1">)])</span>

        <span class="s1">add_data(db, </span><span class="s4">'ActionText'</span><span class="s1">, text.ActionText)</span>
        <span class="s1">add_data(db, </span><span class="s4">'UIText'</span><span class="s1">, text.UIText)</span>
        <span class="s0">#####################################################################</span>
        <span class="s0"># Standard dialogs: FatalError, UserExit, ExitDialog</span>
        <span class="s1">fatal=PyDialog(db, </span><span class="s4">&quot;FatalError&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                     <span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">)</span>
        <span class="s1">fatal.title(</span><span class="s4">&quot;[ProductName] Installer ended prematurely&quot;</span><span class="s1">)</span>
        <span class="s1">fatal.back(</span><span class="s4">&quot;&lt; Back&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">, active = </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">fatal.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Back&quot;</span><span class="s1">, active = </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">fatal.text(</span><span class="s4">&quot;Description1&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">70</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">80</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                   <span class="s4">&quot;[ProductName] setup ended prematurely because of an error.  Your system has not been modified.  To install this program at a later time, please run the installation again.&quot;</span><span class="s1">)</span>
        <span class="s1">fatal.text(</span><span class="s4">&quot;Description2&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">155</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                   <span class="s4">&quot;Click the Finish button to exit the Installer.&quot;</span><span class="s1">)</span>
        <span class="s1">c=fatal.next(</span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, name=</span><span class="s4">&quot;Finish&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Exit&quot;</span><span class="s1">)</span>

        <span class="s1">user_exit=PyDialog(db, </span><span class="s4">&quot;UserExit&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                     <span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">)</span>
        <span class="s1">user_exit.title(</span><span class="s4">&quot;[ProductName] Installer was interrupted&quot;</span><span class="s1">)</span>
        <span class="s1">user_exit.back(</span><span class="s4">&quot;&lt; Back&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">, active = </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">user_exit.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Back&quot;</span><span class="s1">, active = </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">user_exit.text(</span><span class="s4">&quot;Description1&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">70</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">80</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                   <span class="s4">&quot;[ProductName] setup was interrupted.  Your system has not been modified.  &quot;</span>
                   <span class="s4">&quot;To install this program at a later time, please run the installation again.&quot;</span><span class="s1">)</span>
        <span class="s1">user_exit.text(</span><span class="s4">&quot;Description2&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">155</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                   <span class="s4">&quot;Click the Finish button to exit the Installer.&quot;</span><span class="s1">)</span>
        <span class="s1">c = user_exit.next(</span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, name=</span><span class="s4">&quot;Finish&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Exit&quot;</span><span class="s1">)</span>

        <span class="s1">exit_dialog = PyDialog(db, </span><span class="s4">&quot;ExitDialog&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                             <span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">)</span>
        <span class="s1">exit_dialog.title(</span><span class="s4">&quot;Completing the [ProductName] Installer&quot;</span><span class="s1">)</span>
        <span class="s1">exit_dialog.back(</span><span class="s4">&quot;&lt; Back&quot;</span><span class="s1">, </span><span class="s4">&quot;Finish&quot;</span><span class="s1">, active = </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">exit_dialog.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Back&quot;</span><span class="s1">, active = </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">exit_dialog.text(</span><span class="s4">&quot;Description&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">235</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                   <span class="s4">&quot;Click the Finish button to exit the Installer.&quot;</span><span class="s1">)</span>
        <span class="s1">c = exit_dialog.next(</span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, name=</span><span class="s4">&quot;Finish&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Required dialog: FilesInUse, ErrorDlg</span>
        <span class="s1">inuse = PyDialog(db, </span><span class="s4">&quot;FilesInUse&quot;</span><span class="s1">,</span>
                         <span class="s1">x, y, w, h,</span>
                         <span class="s3">19</span><span class="s1">,                </span><span class="s0"># KeepModeless|Modal|Visible</span>
                         <span class="s1">title,</span>
                         <span class="s4">&quot;Retry&quot;</span><span class="s1">, </span><span class="s4">&quot;Retry&quot;</span><span class="s1">, </span><span class="s4">&quot;Retry&quot;</span><span class="s1">, bitmap=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">inuse.text(</span><span class="s4">&quot;Title&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">6</span><span class="s1">, </span><span class="s3">200</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                   <span class="s4">r&quot;{\DlgFontBold8}Files in Use&quot;</span><span class="s1">)</span>
        <span class="s1">inuse.text(</span><span class="s4">&quot;Description&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">23</span><span class="s1">, </span><span class="s3">280</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
               <span class="s4">&quot;Some files that need to be updated are currently in use.&quot;</span><span class="s1">)</span>
        <span class="s1">inuse.text(</span><span class="s4">&quot;Text&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">55</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">50</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                   <span class="s4">&quot;The following applications are using files that need to be updated by this setup. Close these applications and then click Retry to continue the installation or Cancel to exit it.&quot;</span><span class="s1">)</span>
        <span class="s1">inuse.control(</span><span class="s4">&quot;List&quot;</span><span class="s1">, </span><span class="s4">&quot;ListBox&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">107</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">130</span><span class="s1">, </span><span class="s3">7</span><span class="s1">, </span><span class="s4">&quot;FileInUseProcess&quot;</span><span class="s1">,</span>
                      <span class="s2">None</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c=inuse.back(</span><span class="s4">&quot;Exit&quot;</span><span class="s1">, </span><span class="s4">&quot;Ignore&quot;</span><span class="s1">, name=</span><span class="s4">&quot;Exit&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Exit&quot;</span><span class="s1">)</span>
        <span class="s1">c=inuse.next(</span><span class="s4">&quot;Ignore&quot;</span><span class="s1">, </span><span class="s4">&quot;Retry&quot;</span><span class="s1">, name=</span><span class="s4">&quot;Ignore&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Ignore&quot;</span><span class="s1">)</span>
        <span class="s1">c=inuse.cancel(</span><span class="s4">&quot;Retry&quot;</span><span class="s1">, </span><span class="s4">&quot;Exit&quot;</span><span class="s1">, name=</span><span class="s4">&quot;Retry&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;Retry&quot;</span><span class="s1">)</span>

        <span class="s0"># See &quot;Error Dialog&quot;. See &quot;ICE20&quot; for the required names of the controls.</span>
        <span class="s1">error = Dialog(db, </span><span class="s4">&quot;ErrorDlg&quot;</span><span class="s1">,</span>
                       <span class="s3">50</span><span class="s1">, </span><span class="s3">10</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">101</span><span class="s1">,</span>
                       <span class="s3">65543</span><span class="s1">,       </span><span class="s0"># Error|Minimize|Modal|Visible</span>
                       <span class="s1">title,</span>
                       <span class="s4">&quot;ErrorText&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">error.text(</span><span class="s4">&quot;ErrorText&quot;</span><span class="s1">, </span><span class="s3">50</span><span class="s1">,</span><span class="s3">9</span><span class="s1">,</span><span class="s3">280</span><span class="s1">,</span><span class="s3">48</span><span class="s1">,</span><span class="s3">3</span><span class="s1">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
        <span class="s0">#error.control(&quot;ErrorIcon&quot;, &quot;Icon&quot;, 15, 9, 24, 24, 5242881, None, &quot;py.ico&quot;, None, None)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;N&quot;</span><span class="s1">,</span><span class="s3">120</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;No&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorNo&quot;</span><span class="s1">)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;Y&quot;</span><span class="s1">,</span><span class="s3">240</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;Yes&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorYes&quot;</span><span class="s1">)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;A&quot;</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;Abort&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorAbort&quot;</span><span class="s1">)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;C&quot;</span><span class="s1">,</span><span class="s3">42</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorCancel&quot;</span><span class="s1">)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;I&quot;</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;Ignore&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorIgnore&quot;</span><span class="s1">)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;O&quot;</span><span class="s1">,</span><span class="s3">159</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;Ok&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorOk&quot;</span><span class="s1">)</span>
        <span class="s1">error.pushbutton(</span><span class="s4">&quot;R&quot;</span><span class="s1">,</span><span class="s3">198</span><span class="s1">,</span><span class="s3">72</span><span class="s1">,</span><span class="s3">81</span><span class="s1">,</span><span class="s3">21</span><span class="s1">,</span><span class="s3">3</span><span class="s1">,</span><span class="s4">&quot;Retry&quot;</span><span class="s1">,</span><span class="s2">None</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">,</span><span class="s4">&quot;ErrorRetry&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Global &quot;Query Cancel&quot; dialog</span>
        <span class="s1">cancel = Dialog(db, </span><span class="s4">&quot;CancelDlg&quot;</span><span class="s1">, </span><span class="s3">50</span><span class="s1">, </span><span class="s3">10</span><span class="s1">, </span><span class="s3">260</span><span class="s1">, </span><span class="s3">85</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, title,</span>
                        <span class="s4">&quot;No&quot;</span><span class="s1">, </span><span class="s4">&quot;No&quot;</span><span class="s1">, </span><span class="s4">&quot;No&quot;</span><span class="s1">)</span>
        <span class="s1">cancel.text(</span><span class="s4">&quot;Text&quot;</span><span class="s1">, </span><span class="s3">48</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">194</span><span class="s1">, </span><span class="s3">30</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                    <span class="s4">&quot;Are you sure you want to cancel [ProductName] installation?&quot;</span><span class="s1">)</span>
        <span class="s0">#cancel.control(&quot;Icon&quot;, &quot;Icon&quot;, 15, 15, 24, 24, 5242881, None,</span>
        <span class="s0">#               &quot;py.ico&quot;, None, None)</span>
        <span class="s1">c=cancel.pushbutton(</span><span class="s4">&quot;Yes&quot;</span><span class="s1">, </span><span class="s3">72</span><span class="s1">, </span><span class="s3">57</span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, </span><span class="s4">&quot;Yes&quot;</span><span class="s1">, </span><span class="s4">&quot;No&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Exit&quot;</span><span class="s1">)</span>

        <span class="s1">c=cancel.pushbutton(</span><span class="s4">&quot;No&quot;</span><span class="s1">, </span><span class="s3">132</span><span class="s1">, </span><span class="s3">57</span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, </span><span class="s4">&quot;No&quot;</span><span class="s1">, </span><span class="s4">&quot;Yes&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Global &quot;Wait for costing&quot; dialog</span>
        <span class="s1">costing = Dialog(db, </span><span class="s4">&quot;WaitForCostingDlg&quot;</span><span class="s1">, </span><span class="s3">50</span><span class="s1">, </span><span class="s3">10</span><span class="s1">, </span><span class="s3">260</span><span class="s1">, </span><span class="s3">85</span><span class="s1">, modal, title,</span>
                         <span class="s4">&quot;Return&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">)</span>
        <span class="s1">costing.text(</span><span class="s4">&quot;Text&quot;</span><span class="s1">, </span><span class="s3">48</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">194</span><span class="s1">, </span><span class="s3">30</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                     <span class="s4">&quot;Please wait while the installer finishes determining your disk space requirements.&quot;</span><span class="s1">)</span>
        <span class="s1">c = costing.pushbutton(</span><span class="s4">&quot;Return&quot;</span><span class="s1">, </span><span class="s3">102</span><span class="s1">, </span><span class="s3">57</span><span class="s1">, </span><span class="s3">56</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Exit&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Preparation dialog: no user input except cancellation</span>
        <span class="s1">prep = PyDialog(db, </span><span class="s4">&quot;PrepareDlg&quot;</span><span class="s1">, x, y, w, h, modeless, title,</span>
                        <span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s1">prep.text(</span><span class="s4">&quot;Description&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">70</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">40</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                  <span class="s4">&quot;Please wait while the Installer prepares to guide you through the installation.&quot;</span><span class="s1">)</span>
        <span class="s1">prep.title(</span><span class="s4">&quot;Welcome to the [ProductName] Installer&quot;</span><span class="s1">)</span>
        <span class="s1">c=prep.text(</span><span class="s4">&quot;ActionText&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">110</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">, </span><span class="s4">&quot;Pondering...&quot;</span><span class="s1">)</span>
        <span class="s1">c.mapping(</span><span class="s4">&quot;ActionText&quot;</span><span class="s1">, </span><span class="s4">&quot;Text&quot;</span><span class="s1">)</span>
        <span class="s1">c=prep.text(</span><span class="s4">&quot;ActionData&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">135</span><span class="s1">, </span><span class="s3">320</span><span class="s1">, </span><span class="s3">30</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c.mapping(</span><span class="s4">&quot;ActionData&quot;</span><span class="s1">, </span><span class="s4">&quot;Text&quot;</span><span class="s1">)</span>
        <span class="s1">prep.back(</span><span class="s4">&quot;Back&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, active=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">prep.next(</span><span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, active=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">c=prep.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;SpawnDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;CancelDlg&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Feature (Python directory) selection</span>
        <span class="s1">seldlg = PyDialog(db, </span><span class="s4">&quot;SelectFeaturesDlg&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                        <span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s1">seldlg.title(</span><span class="s4">&quot;Select Python Installations&quot;</span><span class="s1">)</span>

        <span class="s1">seldlg.text(</span><span class="s4">&quot;Hint&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">30</span><span class="s1">, </span><span class="s3">300</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                    <span class="s4">&quot;Select the Python locations where %s should be installed.&quot;</span>
                    <span class="s1">% self.distribution.get_fullname())</span>

        <span class="s1">seldlg.back(</span><span class="s4">&quot;&lt; Back&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, active=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">c = seldlg.next(</span><span class="s4">&quot;Next &gt;&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s1">order = </span><span class="s3">1</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[TARGETDIR]&quot;</span><span class="s1">, </span><span class="s4">&quot;[SourceDir]&quot;</span><span class="s1">, ordering=order)</span>
        <span class="s2">for </span><span class="s1">version </span><span class="s2">in </span><span class="s1">self.versions + [self.other_version]:</span>
            <span class="s1">order += </span><span class="s3">1</span>
            <span class="s1">c.event(</span><span class="s4">&quot;[TARGETDIR]&quot;</span><span class="s1">, </span><span class="s4">&quot;[TARGETDIR%s]&quot; </span><span class="s1">% version,</span>
                    <span class="s4">&quot;FEATURE_SELECTED AND &amp;Python%s=3&quot; </span><span class="s1">% version,</span>
                    <span class="s1">ordering=order)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;SpawnWaitDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;WaitForCostingDlg&quot;</span><span class="s1">, ordering=order + </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">, ordering=order + </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">c = seldlg.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Features&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;SpawnDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;CancelDlg&quot;</span><span class="s1">)</span>

        <span class="s1">c = seldlg.control(</span><span class="s4">&quot;Features&quot;</span><span class="s1">, </span><span class="s4">&quot;SelectionTree&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">60</span><span class="s1">, </span><span class="s3">300</span><span class="s1">, </span><span class="s3">120</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                           <span class="s4">&quot;FEATURE&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s4">&quot;PathEdit&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[FEATURE_SELECTED]&quot;</span><span class="s1">, </span><span class="s4">&quot;1&quot;</span><span class="s1">)</span>
        <span class="s1">ver = self.other_version</span>
        <span class="s1">install_other_cond = </span><span class="s4">&quot;FEATURE_SELECTED AND &amp;Python%s=3&quot; </span><span class="s1">% ver</span>
        <span class="s1">dont_install_other_cond = </span><span class="s4">&quot;FEATURE_SELECTED AND &amp;Python%s&lt;&gt;3&quot; </span><span class="s1">% ver</span>

        <span class="s1">c = seldlg.text(</span><span class="s4">&quot;Other&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">200</span><span class="s1">, </span><span class="s3">300</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                        <span class="s4">&quot;Provide an alternate Python location&quot;</span><span class="s1">)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Enable&quot;</span><span class="s1">, install_other_cond)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Show&quot;</span><span class="s1">, install_other_cond)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Disable&quot;</span><span class="s1">, dont_install_other_cond)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Hide&quot;</span><span class="s1">, dont_install_other_cond)</span>

        <span class="s1">c = seldlg.control(</span><span class="s4">&quot;PathEdit&quot;</span><span class="s1">, </span><span class="s4">&quot;PathEdit&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">215</span><span class="s1">, </span><span class="s3">300</span><span class="s1">, </span><span class="s3">16</span><span class="s1">, </span><span class="s3">1</span><span class="s1">,</span>
                           <span class="s4">&quot;TARGETDIR&quot; </span><span class="s1">+ ver, </span><span class="s2">None</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Enable&quot;</span><span class="s1">, install_other_cond)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Show&quot;</span><span class="s1">, install_other_cond)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Disable&quot;</span><span class="s1">, dont_install_other_cond)</span>
        <span class="s1">c.condition(</span><span class="s4">&quot;Hide&quot;</span><span class="s1">, dont_install_other_cond)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Disk cost</span>
        <span class="s1">cost = PyDialog(db, </span><span class="s4">&quot;DiskCostDlg&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                        <span class="s4">&quot;OK&quot;</span><span class="s1">, </span><span class="s4">&quot;OK&quot;</span><span class="s1">, </span><span class="s4">&quot;OK&quot;</span><span class="s1">, bitmap=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">cost.text(</span><span class="s4">&quot;Title&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">6</span><span class="s1">, </span><span class="s3">200</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                 <span class="s4">r&quot;{\DlgFontBold8}Disk Space Requirements&quot;</span><span class="s1">)</span>
        <span class="s1">cost.text(</span><span class="s4">&quot;Description&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">280</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                  <span class="s4">&quot;The disk space required for the installation of the selected features.&quot;</span><span class="s1">)</span>
        <span class="s1">cost.text(</span><span class="s4">&quot;Text&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">53</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">60</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                  <span class="s4">&quot;The highlighted volumes (if any) do not have enough disk space &quot;</span>
              <span class="s4">&quot;available for the currently selected features.  You can either &quot;</span>
              <span class="s4">&quot;remove some files from the highlighted volumes, or choose to &quot;</span>
              <span class="s4">&quot;install less features onto local drive(s), or select different &quot;</span>
              <span class="s4">&quot;destination drive(s).&quot;</span><span class="s1">)</span>
        <span class="s1">cost.control(</span><span class="s4">&quot;VolumeList&quot;</span><span class="s1">, </span><span class="s4">&quot;VolumeCostList&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">100</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">150</span><span class="s1">, </span><span class="s3">393223</span><span class="s1">,</span>
                     <span class="s2">None</span><span class="s1">, </span><span class="s4">&quot;{120}{70}{70}{70}{70}&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">cost.xbutton(</span><span class="s4">&quot;OK&quot;</span><span class="s1">, </span><span class="s4">&quot;Ok&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s3">0.5</span><span class="s1">).event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># WhichUsers Dialog. Only available on NT, and for privileged users.</span>
        <span class="s0"># This must be run before FindRelatedProducts, because that will</span>
        <span class="s0"># take into account whether the previous installation was per-user</span>
        <span class="s0"># or per-machine. We currently don't support going back to this</span>
        <span class="s0"># dialog after &quot;Next&quot; was selected; to support this, we would need to</span>
        <span class="s0"># find how to reset the ALLUSERS property, and how to re-run</span>
        <span class="s0"># FindRelatedProducts.</span>
        <span class="s0"># On Windows9x, the ALLUSERS property is ignored on the command line</span>
        <span class="s0"># and in the Property table, but installer fails according to the documentation</span>
        <span class="s0"># if a dialog attempts to set ALLUSERS.</span>
        <span class="s1">whichusers = PyDialog(db, </span><span class="s4">&quot;WhichUsersDlg&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                            <span class="s4">&quot;AdminInstall&quot;</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s1">whichusers.title(</span><span class="s4">&quot;Select whether to install [ProductName] for all users of this computer.&quot;</span><span class="s1">)</span>
        <span class="s0"># A radio group with two options: allusers, justme</span>
        <span class="s1">g = whichusers.radiogroup(</span><span class="s4">&quot;AdminInstall&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">60</span><span class="s1">, </span><span class="s3">260</span><span class="s1">, </span><span class="s3">50</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                                  <span class="s4">&quot;WhichUsers&quot;</span><span class="s1">, </span><span class="s4">&quot;&quot;</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">)</span>
        <span class="s1">g.add(</span><span class="s4">&quot;ALL&quot;</span><span class="s1">, </span><span class="s3">0</span><span class="s1">, </span><span class="s3">5</span><span class="s1">, </span><span class="s3">150</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s4">&quot;Install for all users&quot;</span><span class="s1">)</span>
        <span class="s1">g.add(</span><span class="s4">&quot;JUSTME&quot;</span><span class="s1">, </span><span class="s3">0</span><span class="s1">, </span><span class="s3">25</span><span class="s1">, </span><span class="s3">150</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s4">&quot;Install just for me&quot;</span><span class="s1">)</span>

        <span class="s1">whichusers.back(</span><span class="s4">&quot;Back&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, active=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">c = whichusers.next(</span><span class="s4">&quot;Next &gt;&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[ALLUSERS]&quot;</span><span class="s1">, </span><span class="s4">&quot;1&quot;</span><span class="s1">, </span><span class="s4">'WhichUsers=&quot;ALL&quot;'</span><span class="s1">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">, ordering = </span><span class="s3">2</span><span class="s1">)</span>

        <span class="s1">c = whichusers.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;AdminInstall&quot;</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;SpawnDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;CancelDlg&quot;</span><span class="s1">)</span>

        <span class="s0">#####################################################################</span>
        <span class="s0"># Installation Progress dialog (modeless)</span>
        <span class="s1">progress = PyDialog(db, </span><span class="s4">&quot;ProgressDlg&quot;</span><span class="s1">, x, y, w, h, modeless, title,</span>
                            <span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, bitmap=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">progress.text(</span><span class="s4">&quot;Title&quot;</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">200</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">0x30003</span><span class="s1">,</span>
                     <span class="s4">r&quot;{\DlgFontBold8}[Progress1] [ProductName]&quot;</span><span class="s1">)</span>
        <span class="s1">progress.text(</span><span class="s4">&quot;Text&quot;</span><span class="s1">, </span><span class="s3">35</span><span class="s1">, </span><span class="s3">65</span><span class="s1">, </span><span class="s3">300</span><span class="s1">, </span><span class="s3">30</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                      <span class="s4">&quot;Please wait while the Installer [Progress2] [ProductName]. &quot;</span>
                      <span class="s4">&quot;This may take several minutes.&quot;</span><span class="s1">)</span>
        <span class="s1">progress.text(</span><span class="s4">&quot;StatusLabel&quot;</span><span class="s1">, </span><span class="s3">35</span><span class="s1">, </span><span class="s3">100</span><span class="s1">, </span><span class="s3">35</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, </span><span class="s4">&quot;Status:&quot;</span><span class="s1">)</span>

        <span class="s1">c=progress.text(</span><span class="s4">&quot;ActionText&quot;</span><span class="s1">, </span><span class="s3">70</span><span class="s1">, </span><span class="s3">100</span><span class="s1">, w-</span><span class="s3">70</span><span class="s1">, </span><span class="s3">20</span><span class="s1">, </span><span class="s3">3</span><span class="s1">, </span><span class="s4">&quot;Pondering...&quot;</span><span class="s1">)</span>
        <span class="s1">c.mapping(</span><span class="s4">&quot;ActionText&quot;</span><span class="s1">, </span><span class="s4">&quot;Text&quot;</span><span class="s1">)</span>

        <span class="s0">#c=progress.text(&quot;ActionData&quot;, 35, 140, 300, 20, 3, None)</span>
        <span class="s0">#c.mapping(&quot;ActionData&quot;, &quot;Text&quot;)</span>

        <span class="s1">c=progress.control(</span><span class="s4">&quot;ProgressBar&quot;</span><span class="s1">, </span><span class="s4">&quot;ProgressBar&quot;</span><span class="s1">, </span><span class="s3">35</span><span class="s1">, </span><span class="s3">120</span><span class="s1">, </span><span class="s3">300</span><span class="s1">, </span><span class="s3">10</span><span class="s1">, </span><span class="s3">65537</span><span class="s1">,</span>
                           <span class="s2">None</span><span class="s1">, </span><span class="s4">&quot;Progress done&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, </span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">c.mapping(</span><span class="s4">&quot;SetProgress&quot;</span><span class="s1">, </span><span class="s4">&quot;Progress&quot;</span><span class="s1">)</span>

        <span class="s1">progress.back(</span><span class="s4">&quot;&lt; Back&quot;</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">, active=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">progress.next(</span><span class="s4">&quot;Next &gt;&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, active=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">progress.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;Back&quot;</span><span class="s1">).event(</span><span class="s4">&quot;SpawnDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;CancelDlg&quot;</span><span class="s1">)</span>

        <span class="s0">###################################################################</span>
        <span class="s0"># Maintenance type: repair/uninstall</span>
        <span class="s1">maint = PyDialog(db, </span><span class="s4">&quot;MaintenanceTypeDlg&quot;</span><span class="s1">, x, y, w, h, modal, title,</span>
                         <span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s1">maint.title(</span><span class="s4">&quot;Welcome to the [ProductName] Setup Wizard&quot;</span><span class="s1">)</span>
        <span class="s1">maint.text(</span><span class="s4">&quot;BodyText&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">63</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">42</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                   <span class="s4">&quot;Select whether you want to repair or remove [ProductName].&quot;</span><span class="s1">)</span>
        <span class="s1">g=maint.radiogroup(</span><span class="s4">&quot;RepairRadioGroup&quot;</span><span class="s1">, </span><span class="s3">15</span><span class="s1">, </span><span class="s3">108</span><span class="s1">, </span><span class="s3">330</span><span class="s1">, </span><span class="s3">60</span><span class="s1">, </span><span class="s3">3</span><span class="s1">,</span>
                            <span class="s4">&quot;MaintenanceForm_Action&quot;</span><span class="s1">, </span><span class="s4">&quot;&quot;</span><span class="s1">, </span><span class="s4">&quot;Next&quot;</span><span class="s1">)</span>
        <span class="s0">#g.add(&quot;Change&quot;, 0, 0, 200, 17, &quot;&amp;Change [ProductName]&quot;)</span>
        <span class="s1">g.add(</span><span class="s4">&quot;Repair&quot;</span><span class="s1">, </span><span class="s3">0</span><span class="s1">, </span><span class="s3">18</span><span class="s1">, </span><span class="s3">200</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, </span><span class="s4">&quot;&amp;Repair [ProductName]&quot;</span><span class="s1">)</span>
        <span class="s1">g.add(</span><span class="s4">&quot;Remove&quot;</span><span class="s1">, </span><span class="s3">0</span><span class="s1">, </span><span class="s3">36</span><span class="s1">, </span><span class="s3">200</span><span class="s1">, </span><span class="s3">17</span><span class="s1">, </span><span class="s4">&quot;Re&amp;move [ProductName]&quot;</span><span class="s1">)</span>

        <span class="s1">maint.back(</span><span class="s4">&quot;&lt; Back&quot;</span><span class="s1">, </span><span class="s2">None</span><span class="s1">, active=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">c=maint.next(</span><span class="s4">&quot;Finish&quot;</span><span class="s1">, </span><span class="s4">&quot;Cancel&quot;</span><span class="s1">)</span>
        <span class="s0"># Change installation: Change progress dialog to &quot;Change&quot;, then ask</span>
        <span class="s0"># for feature selection</span>
        <span class="s0">#c.event(&quot;[Progress1]&quot;, &quot;Change&quot;, 'MaintenanceForm_Action=&quot;Change&quot;', 1)</span>
        <span class="s0">#c.event(&quot;[Progress2]&quot;, &quot;changes&quot;, 'MaintenanceForm_Action=&quot;Change&quot;', 2)</span>

        <span class="s0"># Reinstall: Change progress dialog to &quot;Repair&quot;, then invoke reinstall</span>
        <span class="s0"># Also set list of reinstalled features to &quot;ALL&quot;</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[REINSTALL]&quot;</span><span class="s1">, </span><span class="s4">&quot;ALL&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Repair&quot;'</span><span class="s1">, </span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[Progress1]&quot;</span><span class="s1">, </span><span class="s4">&quot;Repairing&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Repair&quot;'</span><span class="s1">, </span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[Progress2]&quot;</span><span class="s1">, </span><span class="s4">&quot;repairs&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Repair&quot;'</span><span class="s1">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;Reinstall&quot;</span><span class="s1">, </span><span class="s4">&quot;ALL&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Repair&quot;'</span><span class="s1">, </span><span class="s3">8</span><span class="s1">)</span>

        <span class="s0"># Uninstall: Change progress to &quot;Remove&quot;, then invoke uninstall</span>
        <span class="s0"># Also set list of removed features to &quot;ALL&quot;</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[REMOVE]&quot;</span><span class="s1">, </span><span class="s4">&quot;ALL&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Remove&quot;'</span><span class="s1">, </span><span class="s3">11</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[Progress1]&quot;</span><span class="s1">, </span><span class="s4">&quot;Removing&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Remove&quot;'</span><span class="s1">, </span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;[Progress2]&quot;</span><span class="s1">, </span><span class="s4">&quot;removes&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Remove&quot;'</span><span class="s1">, </span><span class="s3">13</span><span class="s1">)</span>
        <span class="s1">c.event(</span><span class="s4">&quot;Remove&quot;</span><span class="s1">, </span><span class="s4">&quot;ALL&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action=&quot;Remove&quot;'</span><span class="s1">, </span><span class="s3">14</span><span class="s1">)</span>

        <span class="s0"># Close dialog when maintenance action scheduled</span>
        <span class="s1">c.event(</span><span class="s4">&quot;EndDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;Return&quot;</span><span class="s1">, </span><span class="s4">'MaintenanceForm_Action&lt;&gt;&quot;Change&quot;'</span><span class="s1">, </span><span class="s3">20</span><span class="s1">)</span>
        <span class="s0">#c.event(&quot;NewDialog&quot;, &quot;SelectFeaturesDlg&quot;, 'MaintenanceForm_Action=&quot;Change&quot;', 21)</span>

        <span class="s1">maint.cancel(</span><span class="s4">&quot;Cancel&quot;</span><span class="s1">, </span><span class="s4">&quot;RepairRadioGroup&quot;</span><span class="s1">).event(</span><span class="s4">&quot;SpawnDialog&quot;</span><span class="s1">, </span><span class="s4">&quot;CancelDlg&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">get_installer_filename(self, fullname):</span>
        <span class="s0"># Factored out to allow overriding in subclasses</span>
        <span class="s2">if </span><span class="s1">self.target_version:</span>
            <span class="s1">base_name = </span><span class="s4">&quot;%s.%s-py%s.msi&quot; </span><span class="s1">% (fullname, self.plat_name,</span>
                                            <span class="s1">self.target_version)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">base_name = </span><span class="s4">&quot;%s.%s.msi&quot; </span><span class="s1">% (fullname, self.plat_name)</span>
        <span class="s1">installer_name = os.path.join(self.dist_dir, base_name)</span>
        <span class="s2">return </span><span class="s1">installer_name</span>
</pre>
</body>
</html>